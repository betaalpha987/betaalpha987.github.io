<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    * {
        box-sizing: border-box;
    }

    html,
    body {
        height: 100%;
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
    }

    .tablink {
        background-color: #aaa;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        font-size: 17px;
        width: 20%;
    }

    .createTopBar,
    .modifyTopBar {
        padding: 5px;
    }

    .createPanels,
    .modifyPanels {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        height: 100%;
    }

    .tablink:hover {
        background-color: #777;
    }

    .tabcontent {
        display: none;
        padding: 50px 20px 10px 20px;
        height: 100%;
    }

    #Create {
        background: linear-gradient(90deg, #ffffff, rgb(255, 255, 125));
    }

    #Modify {
        background: linear-gradient(90deg, #ffffff, rgb(255, 125, 255));
    }

    textarea {
        font-family: Courier, monospace;
        width: 46%;
    }

    textarea.create {
        height: 90%;
    }

    textarea.modify {
        height: 90%;
    }

    .processButton {
        height: 50px;
        width: 50px;
        margin: 5px;
    }
</style>

<body>

    <button class="tablink" onclick="openPage('Create', this, 'yellow')" id="defaultOpen">Create</button>
    <button class="tablink" onclick="openPage('Modify', this, '#fbb2ff')">Modify</button>

    <div id="Create" class="tabcontent">
        <div class="createTopBar">
            <button onclick="return addSampleTemplate()">Sample template</button>
        </div>
        <div class="createPanels">
            <textarea id="taTemplate" class="create" placeholder="Paste a json template here or hit the Sample template button"></textarea>
            <button class="processButton" onclick="return processTemplate()">>></button>
            <textarea id="taOutput" class="create" placeholder="Press the >> button to see the results here"></textarea>
        </div>
    </div>

    <div id="Modify" class="tabcontent">
        <div class="modifyTopBar">
            <h2>Modify JSON file</h2>

            <form id="formModifyJSON">
                <h3>Increment a field</h3>
                <div>
                    <label>
                        Field to increment:
                        <input placeholder="example: poNumber" name="fieldToIncrement" />
                    </label>
                    <label>
                        Starting value:
                        <input name="startingValue" value="0" />
                    </label>
                    <label>
                        <input type="checkbox" name="newField" /> New field
                    </label>
                </div>
            </form>
            <button onclick="return addSampleJSON()">Sample JSON</button>
        </div>
        <div class="modifyPanels">
            <textarea id="taJSONIn" class="modify" placeholder="Paste a JSON array here or hit the Sample JSON button"></textarea>
            <button class="processButton" onclick="return processJSON()">>></button>
            <textarea id="taJSONOut" class="modify" placeholder="Press the >> button to see the results here"></textarea>
        </div>
    </div>

    <script type="text/javascript" src="samples.js"></script>
    <script type="text/javascript" src="premade.js"></script>

    <script>

        // Get the element with id="defaultOpen" and click on it
        document.getElementById("defaultOpen").click();

        /**
         * Reveal the page for the tab the user selected
         */
        function openPage(pageName, elmnt, color) {

            var i, tabcontent, tablinks;

            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }

            document.getElementById(pageName).style.display = "block";
            elmnt.style.backgroundColor = color;

        }

        /**
         * Event handler adds sample template to textarea when button pressed
         */
        function addSampleTemplate() {

            var taTemplate = document.getElementById("taTemplate");
            taTemplate.value = JSON.stringify(sampleTemplate, null, 4);

        }

        /**
         * Event handler adds sample JSON to textarea when button pressed
         */
        function addSampleJSON() {

            var taJSON = document.getElementById("taJSONIn");
            taJSON.value = JSON.stringify(sampleJSON, null, 4);

        }

        /**
         * Process the template and output JSON
         */
        function processTemplate() {
            var taTemplate = document.getElementById("taTemplate");
            var taOutput = document.getElementById("taOutput");

            var template = JSON.parse(taTemplate.value);

            var newJSON = generateJSON(template);

            taOutput.value = JSON.stringify(newJSON, null, 4);
            return false;
        }

        /** 
        * Generate JSON file from passed-in template
        */
        function generateJSON(templateJSON) {

            var recordCount = templateJSON.recordCount;

            // Create array and fill with empty objects
            var arr = [];
            for (var i = 0; i < recordCount; i++) {
                arr.push({});
            };

            // For each item in the user's template, add a key/value pair to every object in the array
            templateJSON.template.forEach(function (item) {
                if (!item.keyName) {
                    console.warn("A template item doesn't have a keyName. Please ensure all template items have one.");
                } else if (!item.type) {
                    console.warn("keyName " + item.keyName + " doesn't have a type. Please ensure all template items have one.");
                } else {

                    switch (item.type) {
                    
                    case "same":

                        arr = processSame(arr, item);
                        break;

                    case "index":

                        arr = processIndex(arr, item);

                        break;
                    case RegExp("^sample", 'i'):


                        // if (!item.startAt) {
                        //     item.startAt = 0;
                        // }
                        // obj[item.keyName] = item.value[item.startAt];
                        // item.startAt++;
                        // if (item.startAt >= item.value.length) {
                        //     item.startAt = 0;
                        // }

                    }

                }


            });

            return arr;

        }

        function processSame(arr, item) {
            if (!item.value) console.warn("Keyname " + item.keyName + ": same-type items need a value.");
            
            arr.forEach(function(record) {
                record[item.keyName] = item.value;
            });

            return arr;
        }

        function processIndex(arr, item) {

            if (!item.startAt) {
                item.startAt = 0
            } else if (typeof(item.startAt) == "string") {

                // Set makeString to true so it can be converted back after doing indexing.
                // Also count number of leading zeroes so they can be added back. 
                item.makeString = true;
                item.leadingZeroes = getLeadingZeroes(item.startAt);
                item.startAt = parseFloat(item.startAt);

            }

            if (item.leadingZeroes) {
                // Total length allows for adding leading zeroes while taking into account 099 -> 100 situations
                item.totalLength = item.startAt.toString().length + item.leadingZeroes
            }

            arr.forEach(function(record) {

                var amount = item.startAt;

                if (item.makeString) {

                    amount = amount.toString();

                    if (item.leadingZeroes) {
                        amount = amount.padStart(item.totalLength, "0");
                    }

                }

                record[item.keyName] = amount;
                item.startAt++;

            });

            function getLeadingZeroes(str) {

                var i;
                for (i = 0; i < str.length; i ++) {
                    if (str[i] !== '0') {
                        break;
                    }
                }
                return i;

            }

            return arr;
        }


        /**
         * Event handler modifies json file by incrementing a field, starting at given value and going
         * up by 1 for each item.
        */
        function processJSON() {

            var form = document.getElementById("formModifyJSON");
            var fieldToIncrement = form.elements["fieldToIncrement"].value;
            var startingValue = form.elements["startingValue"].value;
            var isNewField = form.elements["newField"].checked;

            var taJSONIn = document.getElementById("taJSONIn");
            var taJSONOut = document.getElementById("taJSONOut");

            var jsonIn = JSON.parse(taJSONIn.value);

            var newJSON = incrementField(jsonIn, fieldToIncrement, startingValue, isNewField);

            taJSONOut.value = JSON.stringify(newJSON, null, 4);
            return false;
        }

        /** 
         * Perform field increment operation
         */
        function incrementField(jsonArray, field, value, isNewField) {

            jsonArray.forEach(function (item) {

                if (item[field] || isNewField) {
                    item[field] = typeof field === "string" ? value.toString() : value;
                    value++;
                }

            });

            return (jsonArray);

        }

    </script>

</body>

</html>